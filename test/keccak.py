import io
import unittest
from ctypes import *


from src.hash.keccak import Keccak, StateUnion


class TestKeccak(unittest.TestCase):

    def test_init(self):
        keccak = Keccak()

        buffer = bytearray(200)
        b1 : c_ubyte = 0x00

        for y in range(5):
            for x in range(5):
                for z in range(8):
                    buffer[x * 8 + y * 40 + z] = b1
                b1 = b1 + 1

        input = io.BytesIO(buffer)
        h = keccak.hash(input)

        self.assertEqual('foo'.upper(), 'FOO')

    def test_hello(self):
        keccak = Keccak()

        text = b'hello world'
        input = io.BytesIO(text)
        h = keccak.hash(input, len(text))

        for i in range(32):
            v = h[i]
            print(f"{v:02x}", end="")
        print("")

        #francis -> 828e98e646107a98969689b6132c40f9bec33f0aae1cb9fab45105ff26ff8275
        #hello world -> 47173285a8d7341e5e972fc677286384f802f8ef42a5ec5f03bbfa254cb01fad


    def test_shift(self):

        s = StateUnion()

        s.check_shift()


    def test_reverse(self):

        rc_24 = [
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01],
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x82],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x8a],
            [0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00],
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x8b],
            [0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x01],
            [0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x81],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x09],
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8a],
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88],
            [0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x09],
            [0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x0a],
            [0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x8b],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x8b],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x89],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x02],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80],
            [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x0a],
            [0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x0a],
            [0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x81],
            [0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80],
            [0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x01],
            [0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x08]
        ]

        for r in rc_24:
            for i in range(8):
                v = r[7-i]
                print(f"{v:02x}", end="")
            print("")


